{"ast":null,"code":"import { frame, cancelFrame } from '../frameloop/frame.mjs';\nimport { numberValueTypes } from '../value/types/maps/number.mjs';\nimport { getValueAsType } from '../value/types/utils/get-as-type.mjs';\n\nclass MotionValueState {\n  constructor() {\n    this.latest = {};\n    this.values = new Map();\n  }\n\n  set(name, value, render, computed) {\n    let useDefaultValueType = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n    const existingValue = this.values.get(name);\n\n    if (existingValue) {\n      existingValue.onRemove();\n    }\n\n    const onChange = () => {\n      const v = value.get();\n\n      if (useDefaultValueType) {\n        this.latest[name] = getValueAsType(v, numberValueTypes[name]);\n      } else {\n        this.latest[name] = v;\n      }\n\n      render && frame.render(render);\n    };\n\n    onChange();\n    const cancelOnChange = value.on(\"change\", onChange);\n    computed && value.addDependent(computed);\n\n    const remove = () => {\n      cancelOnChange();\n      render && cancelFrame(render);\n      this.values.delete(name);\n      computed && value.removeDependent(computed);\n    };\n\n    this.values.set(name, {\n      value,\n      onRemove: remove\n    });\n    return remove;\n  }\n\n  get(name) {\n    return this.values.get(name)?.value;\n  }\n\n  destroy() {\n    for (const value of this.values.values()) {\n      value.onRemove();\n    }\n  }\n\n}\n\nexport { MotionValueState };","map":{"version":3,"mappings":";;;;MAMaA,iBAAgB;EAA7BC;IACI,KAAMC,MAAN,GAAkD,EAAlD;IAEQ,cAAS,IAAIC,GAAJ,EAAT;EAyDX;;EApDGC,GAAG,CACCC,IADD,EAECC,KAFD,EAGCC,MAHD,EAICC,QAJD,EAK2B;IAAA,IAA1BC,mBAA0B,uEAAJ,IAAI;IAE1B,MAAMC,aAAa,GAAG,KAAKC,MAAL,CAAYC,GAAZ,CAAgBP,IAAhB,CAAtB;;IAEA,IAAIK,aAAJ,EAAmB;MACfA,aAAa,CAACG,QAAd;IACH;;IAED,MAAMC,QAAQ,GAAG,MAAK;MAClB,MAAMC,CAAC,GAAGT,KAAK,CAACM,GAAN,EAAV;;MAEA,IAAIH,mBAAJ,EAAyB;QACrB,KAAKP,MAAL,CAAYG,IAAZ,IAAoBW,cAAc,CAACD,CAAD,EAAIE,gBAAgB,CAACZ,IAAD,CAApB,CAAlC;MACH,CAFD,MAEO;QACH,KAAKH,MAAL,CAAYG,IAAZ,IAAoBU,CAApB;MACH;;MAEDR,MAAM,IAAIW,KAAK,CAACX,MAAN,CAAaA,MAAb,CAAV;IACH,CAVD;;IAYAO,QAAQ;IAER,MAAMK,cAAc,GAAGb,KAAK,CAACc,EAAN,CAAS,QAAT,EAAmBN,QAAnB,CAAvB;IAEAN,QAAQ,IAAIF,KAAK,CAACe,YAAN,CAAmBb,QAAnB,CAAZ;;IAEA,MAAMc,MAAM,GAAG,MAAK;MAChBH,cAAc;MACdZ,MAAM,IAAIgB,WAAW,CAAChB,MAAD,CAArB;MACA,KAAKI,MAAL,CAAYa,MAAZ,CAAmBnB,IAAnB;MACAG,QAAQ,IAAIF,KAAK,CAACmB,eAAN,CAAsBjB,QAAtB,CAAZ;IACH,CALD;;IAOA,KAAKG,MAAL,CAAYP,GAAZ,CAAgBC,IAAhB,EAAsB;MAAEC,KAAF;MAASO,QAAQ,EAAES;IAAnB,CAAtB;IAEA,OAAOA,MAAP;EACH;;EAEDV,GAAG,CAACP,IAAD,EAAa;IACZ,OAAO,KAAKM,MAAL,CAAYC,GAAZ,CAAgBP,IAAhB,GAAuBC,KAA9B;EACH;;EAEDoB,OAAO;IACH,KAAK,MAAMpB,KAAX,IAAoB,KAAKK,MAAL,CAAYA,MAAZ,EAApB,EAA0C;MACtCL,KAAK,CAACO,QAAN;IACH;EACJ;;AA3DwB","names":["MotionValueState","constructor","latest","Map","set","name","value","render","computed","useDefaultValueType","existingValue","values","get","onRemove","onChange","v","getValueAsType","numberValueTypes","frame","cancelOnChange","on","addDependent","remove","cancelFrame","delete","removeDependent","destroy"],"sources":["C:\\Projects\\TVMazee\\node_modules\\motion-dom\\src\\effects\\MotionValueState.ts"],"sourcesContent":["import { AnyResolvedKeyframe } from \"../animation/types\"\nimport { cancelFrame, frame } from \"../frameloop/frame\"\nimport { MotionValue } from \"../value\"\nimport { numberValueTypes } from \"../value/types/maps/number\"\nimport { getValueAsType } from \"../value/types/utils/get-as-type\"\n\nexport class MotionValueState {\n    latest: { [name: string]: AnyResolvedKeyframe } = {}\n\n    private values = new Map<\n        string,\n        { value: MotionValue; onRemove: VoidFunction }\n    >()\n\n    set(\n        name: string,\n        value: MotionValue,\n        render?: VoidFunction,\n        computed?: MotionValue,\n        useDefaultValueType = true\n    ) {\n        const existingValue = this.values.get(name)\n\n        if (existingValue) {\n            existingValue.onRemove()\n        }\n\n        const onChange = () => {\n            const v = value.get()\n\n            if (useDefaultValueType) {\n                this.latest[name] = getValueAsType(v, numberValueTypes[name])\n            } else {\n                this.latest[name] = v\n            }\n\n            render && frame.render(render)\n        }\n\n        onChange()\n\n        const cancelOnChange = value.on(\"change\", onChange)\n\n        computed && value.addDependent(computed)\n\n        const remove = () => {\n            cancelOnChange()\n            render && cancelFrame(render)\n            this.values.delete(name)\n            computed && value.removeDependent(computed)\n        }\n\n        this.values.set(name, { value, onRemove: remove })\n\n        return remove\n    }\n\n    get(name: string): MotionValue | undefined {\n        return this.values.get(name)?.value\n    }\n\n    destroy() {\n        for (const value of this.values.values()) {\n            value.onRemove()\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}